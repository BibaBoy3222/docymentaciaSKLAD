<!DOCTYPE html>
<html lang='ru'>
<head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>Ожидают подписи</title>
<link href='https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css' rel='stylesheet'></head>
<body class='bg-gray-100 p-6'>
<div class='max-w-4xl mx-auto'>

<nav class="flex flex-wrap gap-4 mb-6" id="navMenu">
  <a href="upload.html" class="nav-link bg-blue-500 text-white p-2 rounded">Загрузка</a>
  <a href="pending.html" class="nav-link bg-yellow-500 text-white p-2 rounded">Ожидают подписи</a>
  <a href="history.html" class="nav-link bg-green-500 text-white p-2 rounded">История</a>
  <a href="rejected.html" class="nav-link bg-red-500 text-white p-2 rounded">Отклоненные</a>
</nav>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const links = document.querySelectorAll('.nav-link');
  const path = window.location.pathname.split('/').pop();
  links.forEach(link => {
    if (link.getAttribute('href') === path) {
      link.classList.add('ring', 'ring-offset-2', 'ring-indigo-500');
    }
  });
});
</script>

<h1 class='text-3xl font-bold mb-6'>Склад: Ожидают подписи</h1>
<div id='pendingList' class='space-y-4'></div>
</div>
<script>
const pendingKey = 'pending_docs';
const signedKey = 'signed_docs';
const rejectedKey = 'rejected_docs';

function renderPendingDocs() {
  const container = document.getElementById('pendingList');
  container.innerHTML = '';
  const docs = JSON.parse(localStorage.getItem(pendingKey)) || [];
  docs.forEach(doc => {
    const card = document.createElement('div');
    card.className = 'p-4 bg-white rounded-2xl shadow';
    card.innerHTML = `
      <p><strong>Поставщик:</strong> ${doc.supplier}</p>
      <p><strong>Счет-фактура:</strong> ${doc.invoice}</p>
      <p><strong>Дата документа:</strong> ${doc.docDate}</p>
      <a href="${doc.fileData}" target="_blank" class="text-blue-500 underline">Открыть документ</a>
      <div class="mt-4 space-y-2">
        <input type="text" placeholder="ФИО подписавшего" class="signerInput w-full p-2 border rounded">
        <button onclick="signDoc(${doc.id})" class="bg-green-500 text-white p-2 rounded w-full">Подтвердить</button>
        <button onclick="rejectDoc(${doc.id})" class="bg-red-500 text-white p-2 rounded w-full">Отклонить</button>
      </div>
    `;
    container.appendChild(card);
  });
}

function signDoc(id) {
  const docs = JSON.parse(localStorage.getItem(pendingKey)) || [];
  const signedDocs = JSON.parse(localStorage.getItem(signedKey)) || [];
  const docIndex = docs.findIndex(d => d.id === id);
  if (docIndex === -1) return;
  const card = document.querySelector(`button[onclick="signDoc(${id})"]`).closest('div');
  const signerInput = card.querySelector('.signerInput');
  if (!signerInput.value.trim()) {
    alert('Введите ФИО!');
    return;
  }
  const signedDoc = {...docs[docIndex], signer: signerInput.value.trim(), signedDate: new Date().toISOString().split('T')[0]};
  signedDocs.push(signedDoc);
  docs.splice(docIndex, 1);
  localStorage.setItem(pendingKey, JSON.stringify(docs));
  localStorage.setItem(signedKey, JSON.stringify(signedDocs));
  renderPendingDocs();
}

function rejectDoc(id) {
  const docs = JSON.parse(localStorage.getItem(pendingKey)) || [];
  const rejectedDocs = JSON.parse(localStorage.getItem(rejectedKey)) || [];
  const docIndex = docs.findIndex(d => d.id === id);
  if (docIndex === -1) return;
  if (confirm('Отклонить документ?')) {
    rejectedDocs.push(docs[docIndex]);
    docs.splice(docIndex, 1);
    localStorage.setItem(pendingKey, JSON.stringify(docs));
    localStorage.setItem(rejectedKey, JSON.stringify(rejectedDocs));
    renderPendingDocs();
  }
}

renderPendingDocs();
</script></body></html>
